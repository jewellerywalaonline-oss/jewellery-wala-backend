<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Refund Processed - Order #<%= order.orderId %></title>
    <style>
      body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        color: #333;
        max-width: 650px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .header {
        text-align: center;
        padding: 20px 0;
        border-bottom: 1px solid #e0e0e0;
        margin-bottom: 20px;
      }
      .logo {
        max-width: 180px;
        height: auto;
        margin-bottom: 15px;
      }
      .content {
        background-color: #ffffff;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      }
      .order-summary, .refund-summary, .shipping-info, .payment-info {
        background: #f9f9f9;
        border: 1px solid #e0e0e0;
        border-radius: 5px;
        padding: 20px;
        margin: 20px 0;
      }
      .section-title {
        color: #2c3e50;
        border-bottom: 1px solid #e0e0e0;
        padding-bottom: 10px;
        margin-top: 0;
      }
      .refund-amount {
        font-size: 28px;
        font-weight: bold;
        color: #27ae60;
        margin: 15px 0;
      }
      .order-id {
        font-weight: bold;
        color: #2c3e50;
        font-size: 18px;
      }
      .item-list {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
      }
      .item-list th {
        text-align: left;
        padding: 10px;
        background-color: #f2f2f2;
        border-bottom: 1px solid #ddd;
      }
      .item-list td {
        padding: 12px 10px;
        border-bottom: 1px solid #eee;
        vertical-align: top;
      }
      .item-list tr:last-child td {
        border-bottom: none;
      }
      .text-right {
        text-align: right;
      }
      .text-center {
        text-align: center;
      }
      .footer {
        margin-top: 30px;
        text-align: center;
        font-size: 13px;
        color: #777;
        padding-top: 20px;
        border-top: 1px solid #eee;
      }
      .status-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .status-completed {
        background-color: #d4edda;
        color: #155724;
      }
      .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin: 10px 0;
      }
      .info-item {
        margin-bottom: 8px;
      }
      .info-label {
        font-weight: 600;
        color: #555;
        margin-bottom: 3px;
      }
      .info-value {
        color: #333;
      }
      @media (max-width: 600px) {
        .info-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      
      <h2 style="color: #2c3e50; margin: 10px 0 5px 0;">Refund Processed Successfully</h2>
      <p style="color: #7f8c8d; margin: 0 0 10px 0;">Your refund request has been processed</p>
      <span class="status-badge status-completed">Refund Completed</span>
    </div>

    <div class="content">
      <p>Hello <strong><%= user.name %></strong>,</p>
      <p>We're pleased to inform you that your refund for Order <strong>#<%= order.orderId %></strong> has been successfully processed.</p>

      <div class="refund-summary">
        <h3 class="section-title">Refund Summary</h3>
        <div class="info-grid">
          <div class="info-item">
            <div class="info-label">Refund Amount</div>
            <div class="refund-amount">₹<%= (order.cancellation.refundAmount || order.pricing.total).toLocaleString('en-IN') %></div>
          </div>
          <div class="info-item">
            <div class="info-label">Refund ID</div>
            <div class="info-value"><%= order.cancellation.refundId || 'N/A' %></div>
          </div>
          <div class="info-item">
            <div class="info-label">Refund Date</div>
            <div class="info-value"><%= new Date(order.cancellation.refundedAt || new Date()).toLocaleDateString('en-IN', { 
              year: 'numeric', 
              month: 'long', 
              day: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            }) %></div>
          </div>
          <div class="info-item">
            <div class="info-label">Payment Method</div>
            <div class="info-value"><%= order.payment.method.toUpperCase() %></div>
          </div>
        </div>
        <p style="margin: 15px 0 0 0; font-size: 14px; color: #666;">
          The refund has been initiated to your original payment method. Please allow 5-7 business days for the amount to reflect in your account.
        </p>
      </div>

      <div class="order-summary">
        <h3 class="section-title">Order Summary</h3>
        <table class="item-list">
          <thead>
            <tr>
              <th>Item</th>
              <th>Qty</th>
              <th class="text-right">Price</th>
            </tr>
          </thead>
          <tbody>
            <% order.items.forEach(item => { %>
            <tr>
              <td>
                <div style="font-weight: 600;"><%= item.name %></div>
                <% if (item.personalizedName) { %>
                  <div style="font-size: 13px; color: #666;">Personalized: <%= item.personalizedName %></div>
                <% } %>
                <div style="font-size: 13px; color: #666;">SKU: <%= item.sku || 'N/A' %></div>
              </td>
              <td><%= item.quantity %></td>
              <td class="text-right">₹<%= item.subtotal.toLocaleString('en-IN') %></td>
            </tr>
            <% }) %>
          </tbody>
          <tfoot>
            <% if (order.pricing.discount.amount > 0) { %>
            <tr>
              <td colspan="2" class="text-right"><strong>Subtotal:</strong></td>
              <td class="text-right">₹<%= order.pricing.subtotal.toLocaleString('en-IN') %></td>
            </tr>
            <tr>
              <td colspan="2" class="text-right"><strong>Discount (<%= order.pricing.discount.couponCode || 'Promo' %>):</strong></td>
              <td class="text-right">-₹<%= order.pricing.discount.amount.toLocaleString('en-IN') %></td>
            </tr>
            <% } %>
            <tr>
              <td colspan="2" class="text-right"><strong>Shipping:</strong></td>
              <td class="text-right"><%= order.pricing.shipping > 0 ? '₹' + order.pricing.shipping.toLocaleString('en-IN') : 'FREE' %></td>
            </tr>
            <tr style="font-size: 16px; font-weight: bold;">
              <td colspan="2" class="text-right">Total Refund Amount:</td>
              <td class="text-right" style="color: #27ae60;">₹<%= (order.cancellation.refundAmount || order.pricing.total).toLocaleString('en-IN') %></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <div class="shipping-info">
        <h3 class="section-title">Shipping Information</h3>
        <div class="info-grid">
          <div>
            <div class="info-label">Shipping Address</div>
            <div class="info-value">
              <%= order.shippingAddress.fullName %><br>
              <%= order.shippingAddress.street %><% if (order.shippingAddress.area) { %>, 
              <%= order.shippingAddress.area %><% } %><br>
              <% if (order.shippingAddress.addressLine1) { %>
                <%= order.shippingAddress.addressLine1 %><br>
              <% } %>
              <%= order.shippingAddress.city %>, 
              <%= order.shippingAddress.state %> - 
              <%= order.shippingAddress.pincode %><br>
              <%= order.shippingAddress.country %><br>
              <% if (order.shippingAddress.landmark) { %>
                <strong>Landmark:</strong> <%= order.shippingAddress.landmark %><br>
              <% } %>
              <strong>Phone:</strong> <%= order.shippingAddress.phone %><br>
              <strong>Email:</strong> <%= order.shippingAddress.email %>
            </div>
          </div>
          <div>
            <div class="info-label">Order Information</div>
            <div class="info-value">
              <strong>Order ID:</strong> #<%= order.orderId %><br>
              <strong>Order Date:</strong> <%= new Date(order.createdAt).toLocaleDateString('en-IN', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
              }) %><br>
              <strong>Payment Method:</strong> <%= order.payment.method.toUpperCase() %><br>
              <strong>Payment Status:</strong> 
                <span style="text-transform: capitalize;"><%= order.payment.status %></span><br>
              <strong>Refund Status:</strong> 
                <span style="color: #27ae60; font-weight: 600;">Completed</span>
            </div>
          </div>
        </div>
      </div>

      <div style="margin: 30px 0; text-align: center;">
        <p>If you have any questions about your refund, please don't hesitate to contact our support team.</p>
        <p style="margin-top: 10px;">
          <a href="<%= process.env.CLIENT_URL || '#' %>/contact" 
             style="display: inline-block; 
                    padding: 12px 25px; 
                    background-color: #2c3e50; 
                    color: white; 
                    text-decoration: none; 
                    border-radius: 4px; 
                    font-weight: 500;">
            Contact Support
          </a>
        </p>
      </div>

      <p>Thank you for shopping with us!</p>
      <p>
        Best regards,<br>
        <strong>The <%= process.env.APP_NAME || 'Jewellery Walla' %> Team</strong>
      </p>
    </div>

    <div class="footer">
      <p>
        &copy; <%= new Date().getFullYear() %> <%= process.env.APP_NAME || 'Jewellery Walla' %>. All rights reserved.<br>
        <span style="font-size: 12px; color: #95a5a6;">
          This is an automated message, please do not reply directly to this email.
        </span>
      </p>
    </div>
  </body>
</html>
